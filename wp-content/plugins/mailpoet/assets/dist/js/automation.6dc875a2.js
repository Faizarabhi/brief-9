"use strict";(self.webpackChunkMailPoet3=self.webpackChunkMailPoet3||[]).push([[916],{66609:function(n,e,t){var o=t(52524),r=t.n(o),a=t(45993);const i=window.mailpoet_automation_api,d=`${i.root}/mailpoet/v1/automation`,s=(n,e)=>{const[t,o]=(0,a.useState)({data:void 0,loading:!1,error:void 0});return[(0,a.useCallback)((async t=>{var r;o((n=>({...n,loading:!0})));const a=await((n,e)=>fetch(`${d}/${n}`,e))(n,{...e,...t,headers:{"content-type":"application/json",...null!==(r=null==t?void 0:t.headers)&&void 0!==r?r:{},"x-wp-nonce":i.nonce}});try{const n=await a.json(),e=a.ok?null:{...a,data:n};o((t=>({...t,data:n,error:e})))}catch(n){const e={response:a};o((n=>({...n,error:e})))}finally{o((n=>({...n,loading:!1})))}}),[e,n]),t]},l=n=>n.toString(16).padStart(2,"0"),c=()=>{if(!window.crypto||!window.crypto.getRandomValues)throw new Error("Web Crypto API 'crypto.getRandomValues' is not available");return Array.from(window.crypto.getRandomValues(new Uint8Array(8))).map(l).join("")};var u=t(15451);const v=()=>{const n={id:c(),type:"action",key:"core:wait",args:{seconds:60}},e=(t=n.id,{id:c(),type:"trigger",key:"mailpoet:segment:subscribed",next_step_id:t});var t;return{name:`Test ${(new Date).toISOString()}`,steps:{[e.id]:e,[n.id]:n}}};function w(){var n,e;const[t,{loading:o,error:r}]=s("workflows",{method:"POST"});return(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{type:"button",onClick:()=>t({body:JSON.stringify(v())}),disabled:o,children:"Create testing workflow"}),r&&(0,u.jsx)("div",{children:null!==(n=null==r||null===(e=r.data)||void 0===e?void 0:e.message)&&void 0!==n?n:"An unknown error occurred"})]})}function p(){const{data:n,loading:e,error:t}=((n,e)=>{const[t,o]=s("workflows",void 0);return(0,a.useEffect)((()=>{t()}),[]),o})();return!n||e?(0,u.jsx)("div",{children:"Calling API..."}):(0,u.jsx)("div",{children:t?"API error!":"API OK âœ“"})}function m(){var n,e;const[t,{loading:o,error:r}]=s("system/database",{method:"POST"});return(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{type:"button",onClick:()=>t(),disabled:o,children:"Recreate DB schema (data will be lost)"}),r&&(0,u.jsx)("div",{children:null!==(n=null==r||null===(e=r.data)||void 0===e?void 0:e.message)&&void 0!==n?n:"An unknown error occurred"})]})}function h(){var n,e;const[t,{loading:o,error:r}]=s("system/database",{method:"DELETE"});return(0,u.jsxs)("div",{children:[(0,u.jsx)("button",{type:"button",onClick:async()=>{await t(),window.location.href="/wp-admin/admin.php?page=mailpoet-experimental"},disabled:o,children:"Delete DB schema & deactivate feature"}),r&&(0,u.jsx)("div",{children:null!==(n=null==r||null===(e=r.data)||void 0===e?void 0:e.message)&&void 0!==n?n:"An unknown error occurred"})]})}function g(){return(0,u.jsxs)("div",{children:[(0,u.jsx)(p,{}),(0,u.jsx)(w,{}),(0,u.jsx)(m,{}),(0,u.jsx)(h,{})]})}window.addEventListener("DOMContentLoaded",(()=>{const n=document.getElementById("mailpoet_automation");n&&r().render((0,u.jsx)(g,{}),n)}))}},function(n){n.O(0,[351],(function(){return 66609,n(n.s=66609)})),n.O()}]);